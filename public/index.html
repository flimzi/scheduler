<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <button>send</button>
    <script>
        document.querySelector('button').onclick = function(e) {
            // i feel like token should not be included in the query
            const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MjA4MywiZW1haWwiOiI0MjBza3VuQGdtYWlsLmNvbSIsInJvbGUiOjEsImZpcnN0X25hbWUiOm51bGwsImlhdCI6MTcyMzgxOTY0NCwiZXhwIjoxNzU1MzU1NjQ0fQ.NoESKkwNN3JuB0OGc68G8TsYpZVFL-QZNxHhepiXXkw'
            // wss not doable on localhost
            const ws = new WebSocket('ws://localhost:3000', token)

            ws.addEventListener('message', function(event) {
                const { type, data } = JSON.parse(event.data)

                // this is onopen
                if (type === 0 && !this.ready) {
                    ws.send(JSON.stringify({ type: 100 }))

                    this.ready = true
                    return
                }

                switch (type) {
                    case 400:
                        document.body.innerText += data
                }
            })

            ws.addEventListener('error', function(error) {
                console.log('error', error)
            })
        }


    </script>
</body>
</html>